#!/bin/bash

percent=7

function test {
	acpi -b | awk -F'[,:%]' '{print $2, $3}' | {
		read -r status capacity

		if [ "$status" = Discharging -a "$capacity" -lt $percent ]; then
			logger "Critical battery threshold reached: hibernating."
			sudo systemctl poweroff
		fi
	}
}

while :; do
	test
	sleep 120
done
